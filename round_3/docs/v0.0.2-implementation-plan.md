# PARANOID v0.0.2 Implementation Plan

**Driver:** Droid
**Navigator:** Claude
**Branch:** `feature/v0.0.2-enhancements`
**Worktree:** `/Users/jonc/Workspace/vibelympics-v002`

---

## Overview

Upgrading PARANOID from functional MVP (v0.0.1) to AI-enhanced, production-ready (v0.0.2).

**Key Features:**
1. AI-generated roasts using Claude API
2. CVE detection with famous vulnerability database
3. Cursed package detection (left-pad, event-stream, etc.)
4. Input validation, rate limiting, security hardening

---

## Phase 1: Foundation Fixes (2 hours)

| ID | Task | Status | Notes |
|----|------|--------|-------|
| 1.1 | Create captions.json | ✅ DONE | Already exists with 95 captions |
| 1.2 | Input size validation (100KB max) | ✅ DONE | Added to RoastRequest model |
| 1.3 | Fix CORS - remove wildcard | ✅ DONE | Now uses ALLOWED_ORIGINS env var |
| 1.4 | Meme cleanup job | ✅ DONE | cleanup_old_memes() runs 10% of requests |
| 1.5 | Bundle Impact font | ⏳ PENDING | Need to download and add to container |
| 1.6 | Rate limiting (10/min) | ✅ DONE | check_rate_limit() with 429 response |

---

## Phase 2: CVE & Cursed Detection (2 hours)

| ID | Task | Status | Notes |
|----|------|--------|-------|
| 2.1 | Create cves.json | ⏳ PENDING | 50+ famous CVEs with version ranges |
| 2.2 | CVE matching logic | ⏳ PENDING | services/cve_detector.py |
| 2.3 | Create cursed.json | ⏳ PENDING | left-pad, event-stream, colors, faker |
| 2.4 | Cursed package detection | ⏳ PENDING | services/cursed_detector.py |
| 2.5 | Add findings to response | ⏳ PENDING | Include CVE/cursed in roast |

**CVE Database Structure:**
```json
{
  "lodash": {
    "CVE-2019-10744": {
      "severity": "critical",
      "affected": "<4.17.12",
      "description": "Prototype pollution"
    }
  }
}
```

**Cursed Package Structure:**
```json
{
  "left-pad": {
    "incident": "2016 npm deletion",
    "severity": "legendary",
    "roasts": ["The package that broke the internet..."]
  }
}
```

---

## Phase 3: AI Integration (3 hours)

| ID | Task | Status | Notes |
|----|------|--------|-------|
| 3.1 | Add ANTHROPIC_API_KEY support | ✅ DONE | Environment variable |
| 3.2 | Create ai_roaster.py | ✅ DONE | Claude client wrapper |
| 3.3 | Design prompt template | ✅ DONE | See below |
| 3.4 | AI roast generation | ✅ DONE | Generate personalized roasts |
| 3.5 | AI meme selection | ✅ DONE | Pick best template |
| 3.6 | Frontend AI toggle | ✅ DONE | "use_ai" checkbox |
| 3.7 | Fallback to captions | ✅ DONE | On API failure |

**AI Prompt Template:**
```
You are PARANOID, a sarcastic supply chain security roaster.

Analyze these dependencies and generate a brutal but funny roast:
- Total: {dep_count} dependencies
- Packages: {package_list}
- CVEs found: {cve_list}
- Cursed packages: {cursed_list}

Also select the most appropriate meme template from:
- fine: "This is Fine" dog - denial, everything burning
- drake: Drake Hotline Bling - bad vs good choices  
- batman: Batman Slapping Robin - stopping bad behavior
- buzz: Buzz Lightyear - "X everywhere"
- disaster: Disaster Girl - watching things burn
- fry: Futurama Fry - uncertainty
- rollsafe: Roll Safe - bad logic

Return JSON:
{
  "roast": "Your 2-3 sentence roast",
  "template": "template_id",
  "severity": "low|medium|high|critical"
}
```

**Fallback Strategy:**
1. Try Claude API with 10s timeout
2. If fails, use pre-written captions from captions.json
3. Log failure for debugging
4. Never show error to user - always return a roast

---

## Phase 4: Additional Features (1.5 hours)

| ID | Task | Status | Notes |
|----|------|--------|-------|
| 4.1 | go.mod parser | ⏳ PENDING | Complete parser trio |
| 4.2 | SBOM-of-SBOM endpoint | ⏳ PENDING | Recursive compliance joke |
| 4.3 | Typosquatting detection | ⏳ PENDING | lodahs, reqeusts, etc. |

---

## Phase 5: Testing (1.5 hours)

| ID | Task | Status | Notes |
|----|------|--------|-------|
| 5.1 | Tests for paranoia.py | ⏳ PENDING | |
| 5.2 | Tests for meme_generator.py | ⏳ PENDING | |
| 5.3 | Tests for CVE/cursed detection | ⏳ PENDING | |
| 5.4 | Integration test | ⏳ PENDING | Full roast flow |
| 5.5 | AI fallback test | ⏳ PENDING | |

---

## Phase 6: Demo Prep (1 hour)

| ID | Task | Status | Notes |
|----|------|--------|-------|
| 6.1 | Demo script | ⏳ PENDING | Written walkthrough |
| 6.2 | Demo input files | ⏳ PENDING | 5 scenarios |
| 6.3 | Paranoia escalation doc | ⏳ PENDING | How to trigger levels |
| 6.4 | Container verification | ⏳ PENDING | Full build + run |

---

## Architecture

```
backend/
├── main.py                    # FastAPI app (updated)
├── services/
│   ├── ai_roaster.py          # NEW: Claude integration
│   ├── analyzer.py            # Dependency parsing
│   ├── cve_detector.py        # NEW: CVE matching
│   ├── cursed_detector.py     # NEW: Cursed packages
│   ├── caption_selector.py    # Fallback captions
│   ├── meme_generator.py      # memegen.link API
│   └── paranoia.py            # State machine
├── data/
│   ├── captions.json          # 95 pre-written roasts
│   ├── cves.json              # NEW: CVE database
│   └── cursed.json            # NEW: Cursed packages
└── tests/
    ├── test_analyzer.py       # Existing
    ├── test_cve_detector.py   # NEW
    └── test_ai_roaster.py     # NEW
```

---

## API Changes

**POST /roast Request:**
```json
{
  "input_type": "package_json",
  "content": "...",
  "include_sbom": true,
  "use_ai": false  // NEW
}
```

**POST /roast Response:**
```json
{
  "meme_url": "/memes/abc123.png",
  "roast_summary": "...",
  "findings": [
    {"type": "cve", "severity": "high", "detail": "..."},
    {"type": "cursed", "severity": "legendary", "detail": "..."}
  ],
  "ai_generated": true,  // NEW
  "cve_count": 3,        // NEW  
  "cursed_count": 1      // NEW
}
```

---

## Environment Variables

```bash
# Required
PORT=8000

# AI (optional - enables AI roasts)
ANTHROPIC_API_KEY=sk-ant-...

# Security
ALLOWED_ORIGINS=http://localhost:8000,https://paranoid.example.com
MAX_INPUT_SIZE=102400
MAX_DEPENDENCIES=500
RATE_LIMIT_PER_MINUTE=10

# Cleanup
MEME_TTL_SECONDS=3600
```

---

## Current Progress

**Completed:**
- [x] Input size validation (100KB max)
- [x] CORS hardening (specific origins)
- [x] Rate limiting (10 req/min with sarcastic 429)
- [x] Meme cleanup (TTL-based)
- [x] use_ai parameter in request model

**In Progress:**
- [ ] CVE detection system

**Next Up:**
- Create cves.json with famous vulnerabilities
- Implement cve_detector.py service
- Create cursed.json
- Implement cursed_detector.py service

---

## Navigator Review Requested

Please review:
1. Phase 1 changes in main.py - input validation, CORS, rate limiting
2. Architecture for CVE/cursed detection
3. AI prompt design for roast generation
4. Any risks or concerns with the approach

---

*Last Updated: Round 3 Championship*
